<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cat√°logo Servicios Extras - Hotel 5‚òÖ</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="bg-decor" aria-hidden="true"></div>

  <div class="wrap" role="application">
    <header class="header">
      <div class="brand">
        <div class="logo" aria-hidden="true"><span>H</span></div>
        <div class="brand-text">
          <h1>Servicios Extras - Hotel 5‚òÖ</h1>
          <div class="muted small">Escanea el QR o usa este cat√°logo</div>
        </div>
      </div>

      <div class="controls" role="toolbar" aria-label="Controles">
        <input id="searchInput" type="search" placeholder="Buscar servicio o producto..." class="search" />
        <select id="lang" aria-label="Idioma">
          <option value="es">Espa√±ol</option>
          <option value="en">English</option>
        </select>
        <button id="toggleSidebarBtn" class="btn primary">Men√∫</button>
        <button id="toggleCartBtn" class="btn">Carrito</button>
      </div>
    </header>

    <div class="layout" id="layout">
      <!-- SIDEBAR -->
      <aside id="sidebar" class="sidebar" aria-label="Men√∫ de categor√≠as">
        <div class="side-header">
          <div>
            <div class="menu-title">Categor√≠as</div>
            <div class="muted small">Filtra por secci√≥n</div>
          </div>
          <div class="side-actions">
            <button id="minimizeSidebar" class="icon">_</button>
            <button id="closeSidebar" class="icon">‚úï</button>
          </div>
        </div>

        <div class="category" id="categoryList"></div>

        <div class="showall">
          <button id="showAll" class="btn">Mostrar todo</button>
        </div>

        <hr />

        <div class="menu-title small">Fondo (personalizable)</div>
        <div class="bg-control">
          <input id="bgUrl" placeholder="URL imagen de fondo (https...)" />
          <button id="applyBg" class="btn">Aplicar</button>
        </div>
        <div class="bg-control">
          <select id="bgGradient">
            <option value="linear-gradient(180deg,#eef6fb 0%,#f7fafc 100%)">Azul claro</option>
            <option value="linear-gradient(180deg,#fff7ed 0%,#fff1f0 100%)">Crema</option>
            <option value="linear-gradient(180deg,#f3fff4 0%,#eef9ff 100%)">Verde suave</option>
            <option value="linear-gradient(180deg,#1e3a8a 0%,#0ea5e9 100%)">Azul intenso</option>
          </select>
          <button id="applyGradient" class="btn">Usar gradiente</button>
        </div>
      </aside>

      <!-- MAIN -->
      <main class="main">
        <section id="promoContainer" class="promo" aria-live="polite">
          <img id="promoImg" src="" alt="" />
          <div class="txt">
            <h3 id="promoTitle">Promoci√≥n</h3>
            <p id="promoDesc">Descripci√≥n de promoci√≥n</p>
          </div>
          <div class="promo-actions">
            <div id="promoPrice" class="offers-banner">-</div>
            <div class="promo-controls">
              <button id="prevPromo" class="icon">‚óÄ</button>
              <button id="nextPromo" class="btn primary">‚ñ∂</button>
            </div>
          </div>
        </section>

        <div class="resultsbar">
          <div class="muted" id="resultsInfo">Mostrando todos los servicios</div>
          <div class="muted">Idioma: <strong id="currentLang">Espa√±ol</strong></div>
        </div>

        <section id="catalog" class="cards" aria-live="polite"></section>
      </main>

      <!-- CART -->
      <aside id="cart" class="cart" aria-label="Carrito de compras">
        <div class="cart-header">
          <div>
            <h3 id="cartTitle">Carrito</h3>
            <div class="muted small" id="cartCount">0 items</div>
          </div>
          <div class="cart-actions">
            <button id="minimizeCart" class="icon">_</button>
            <button id="closeCart" class="icon">‚úï</button>
          </div>
        </div>

        <div id="cartItems" class="cart-items"></div>
        <div class="total" id="cartTotal">Total: $0.00</div>

        <div class="room">
          <label for="roomInput" id="roomLabel">N√∫mero de habitaci√≥n</label>
          <input id="roomInput" type="text" placeholder="e.g. 101" />
        </div>

        <div class="cart-actions-row">
          <button id="clearBtn" class="btn">Vaciar</button>
          <button id="requestBtn" class="btn primary">Solicitar</button>
        </div>

        <div class="muted small note">Las solicitudes se env√≠an por correo al equipo de servicios del hotel.</div>
      </aside>
    </div>

    <footer class="footer">Edita productos en el arreglo <code>catalog</code> dentro del script</footer>
  </div>

  <!-- Compact bars para m√≥vil -->
  <div id="sidebarCompactBar" class="compact-bar" aria-hidden="true"></div>
  <div id="cartCompactBar" class="compact-bar" aria-hidden="true"></div>

  <script>
    /* ==========================
       CONFIG (easy-edit at top)
       Change the email below as needed
       ========================== */
    const EMAIL_DESTINATION = "ejecutivo3.rrpp@ppesquero.co.cu";

    /* ---------- Data: promotions & catalog ---------- */
    const promotions = [
      { id:"p1", img:"https://raw.githubusercontent.com/DavidNK01/catalogo-hotel/fdb790fd2ea373dc74abce76f2a9d65fe3d2a845/promo_carnaval.jpg", title:{es:"20% en Carnaval",en:"20% off Carnaval"}, desc:{es:"Experiencia inolvidable. Oferta por tiempo limitado.",en:"Gourmet private dinner experience. Limited time offer."}, price:{es:"Desde $96",en:"From $96"} },
      { id:"p2", img:"https://images.unsplash.com/photo-1556228720-5f7c8a1da0f9?w=1200&q=60", title:{es:"Masaje relajante 60min",en:"Relaxing Massage 60min"}, desc:{es:"Rel√°jate con nuestro masaje profesional. Reserva con descuento.",en:"Relax with our professional massage. Book now with discount."}, price:{es:"$70",en:"$70"} }
    ];
    let promoIndex = 0, promoTimer = null, promoInterval = 6000;

    const catalog = [
      { id:"spa001", cat:"Tratamientos del SPA", img:"https://www.google.com/imgres?q=masaje%20hotel%20playa%20pesquero&imgurl=https%3A%2F%2Foncubanews.com%2Fwp-content%2Fuploads%2F2017%2F02%2FDSC_0525_2.jpg&imgrefurl=https%3A%2F%2Foncubanews.com%2Fcuba%2Feconomia%2Fturismo%2Fgaviota-y-los-hoteles-para-adultos%2F&docid=d1cCkAXzLblcjM&tbnid=yBRBXRp-R87V-M&w=900&h=500&hcb=2", name:{es:"Masaje Relajante 60min",en:"Relaxing Massage 60min"}, desc:{es:"Masaje profesional para aliviar tensiones.",en:"Professional massage to relieve tension."}, price:70.00, currency:"USD", offer:false },
      { id:"spa002", cat:"Tratamientos del SPA", img:"https://www.google.com/imgres?q=masaje%20hotel%20playa%20pesquero&imgurl=https%3A%2F%2Fwww.gaviotahotels.com%2F.imaging%2Fmte%2Fadgtravel-theme%2Fh450%2Fdam%2FADG-GaviotaHotels%2Fhoteles%2Ffotos-bien-nombradas%2Fholguin%2Fhotel-playa-pesquero-ai%2Fservicios%2Fmasajes%2Fhoteles-holguin-hotel-playa-pesquero-servicios-13.jpg%2Fjcr%3Acontent%2Fhoteles-holguin-hotel-playa-pesquero-servicios-13.jpg&imgrefurl=https%3A%2F%2Fwww.gaviotahotels.com%2Fen%2Fhotels-in-cuba%2Fholguin%2Fhotel-playa-pesquero%2Fservices&docid=C9IrRSSQHdcY0M&tbnid=9MGttVEbPME1rM&w=600&h=450&hcb=2", name:{es:"Masaje Profundo 90min",en:"Deep Massage 90min"}, desc:{es:"Terap√©utico profundo para contracturas.",en:"Therapeutic deep massage for knots."}, price:95.00, currency:"USD", offer:true, offerText:{es:"10% hoy",en:"10% today"}, offerPrice:85.50 },

      { id:"belleza001", cat:"Sal√≥n de Belleza", img:"https://www.google.com/imgres?q=peinados%20profecional&imgurl=https%3A%2F%2Flookaside.fbsbx.com%2Flookaside%2Fcrawler%2Fmedia%2F%3Fmedia_id%3D4562857240422033&imgrefurl=https%3A%2F%2Fwww.facebook.com%2FDpelosInstitute%2Fposts%2Fhola-huanuco-%25EF%25B8%258Fte-apasiona-el-arte-de-hacer-trenzas-y-peinados-deseando-ser-una-p%2F4562857323755358%2F&docid=Um-IroWvWtMEvM&tbnid=udjVBhhFPwNKmM&w=1280&h=1600&hcb=2", name:{es:"Peinado Profesional",en:"Professional Hairstyling"}, desc:{es:"Peinado y styling para ocasiones especiales.",en:"Hair styling for special occasions."}, price:45.00, currency:"USD", offer:false },

      { id:"boda001", cat:"Servicio de Boda", img:"https://www.google.com/imgres?q=boda%20playa%20pesquero&imgurl=https%3A%2F%2Fi0.wp.com%2Ffoodandpleasure.com%2Fwp-content%2Fuploads%2F2023%2F12%2Fboda-en-la-playa-boda-en-cabo-san-lucas-foto-pueblobonito.jpg%3Ffit%3D1080%252C720%26ssl%3D1&imgrefurl=https%3A%2F%2Ffoodandpleasure.com%2Fplayas-para-casarse-mexico%2F&docid=OYtrGHRdc21UoM&tbnid=D9D4mmMu7Gt5DM&w=1080&h=720&hcb=2", name:{es:"Paquete Boda B√°sico",en:"Basic Wedding Package"}, desc:{es:"Coordinaci√≥n y espacios para ceremonia √≠ntima.",en:"Coordination and intimate ceremony spaces."}, price:1200.00, currency:"USD", offer:false },

      { id:"recepcion001", cat:"Ventas en Recepci√≥n", img:"https://github.com/DavidNK01/catalogo-hotel/blob/main/hab_luxury_family.jpg", name:{es:"Upsellin a habitaci√≥n Luxury",en:"Upsellin to a Luxury Room"}, desc:{es:"Habitaci√≥n de lujo, con servicio de mayordomo, mini-bar VIP, cena con langosta, botella de ron alto est√°ndar.",en:"Printed map with local recommendations."}, price:35.00, currency:"USD", offer:false },

      { id:"carta001", cat:"Extra Carta Comida", img:"https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=800&q=60", name:{es:"Tapa Gourmet",en:"Gourmet Starter"}, desc:{es:"Entrada seleccionada por el chef.",en:"Chef-selected starter."}, price:12.00, currency:"USD", offer:false },

      { id:"dinner001", cat:"Cenas privadas", img:"https://images.unsplash.com/photo-1541542684-6b2a3c2b3f9d?w=800&q=60", name:{es:"Cena Privada para 2",en:"Private Dinner for 2"}, desc:{es:"Men√∫ gourmet y ambiente privado.",en:"Gourmet menu and private ambiance."}, price:120.00, currency:"USD", offer:true, offerText:{es:"20% de descuento hoy",en:"20% off today"}, offerPrice:96.00 },

      { id:"vino001", cat:"Vinos y Cavas", img:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=800&q=60", name:{es:"Botella Premium",en:"Premium Bottle"}, desc:{es:"Selecci√≥n de la cava para su disfrute.",en:"Cellar selection for your enjoyment."}, price:45.00, currency:"USD", offer:false },

      { id:"lav001", cat:"Servicio de Lavander√≠a", img:"https://images.unsplash.com/photo-1542831371-d531d36971e6?w=800&q=60", name:{es:"Lavado Express",en:"Express Wash"}, desc:{es:"Servicio r√°pido con entrega en el d√≠a.",en:"Quick service with same-day delivery."}, price:8.00, currency:"USD", offer:false }
    ];

    const categoriesOrder = ["Tratamientos del SPA","Sal√≥n de Belleza","Servicio de Boda","Ventas en Recepci√≥n","Extra Carta Comida","Cenas privadas","Vinos y Cavas","Servicio de Lavander√≠a"];

    /* ---------- UI refs ---------- */
    const catalogEl = document.getElementById("catalog");
    const langSelect = document.getElementById("lang");
    const cartItemsEl = document.getElementById("cartItems");
    const cartTotalEl = document.getElementById("cartTotal");
    const requestBtn = document.getElementById("requestBtn");
    const clearBtn = document.getElementById("clearBtn");
    const roomInput = document.getElementById("roomInput");
    const promoImg = document.getElementById("promoImg");
    const promoTitle = document.getElementById("promoTitle");
    const promoDesc = document.getElementById("promoDesc");
    const promoPrice = document.getElementById("promoPrice");
    const prevPromo = document.getElementById("prevPromo");
    const nextPromo = document.getElementById("nextPromo");
    const resultsInfo = document.getElementById("resultsInfo");
    const currentLangLabel = document.getElementById("currentLang");
    const categoryList = document.getElementById("categoryList");
    const sidebar = document.getElementById("sidebar");
    const toggleSidebarBtn = document.getElementById("toggleSidebarBtn");
    const toggleCartBtn = document.getElementById("toggleCartBtn");
    const minimizeSidebarBtn = document.getElementById("minimizeSidebar");
    const closeSidebarBtn = document.getElementById("closeSidebar");
    const minimizeCartBtn = document.getElementById("minimizeCart");
    const closeCartBtn = document.getElementById("closeCart");
    const cartEl = document.getElementById("cart");
    const searchInput = document.getElementById("searchInput");
    const cartCountEl = document.getElementById("cartCount");
    const bgUrlInput = document.getElementById("bgUrl");
    const applyBgBtn = document.getElementById("applyBg");
    const bgGradientSel = document.getElementById("bgGradient");
    const applyGradientBtn = document.getElementById("applyGradient");
    const showAllBtn = document.getElementById("showAll");
    const sidebarCompactBar = document.getElementById('sidebarCompactBar');
    const cartCompactBar = document.getElementById('cartCompactBar');

    /* ---------- state ---------- */
    let lang = 'es';
    let cart = {};
    let activeCategory = null;
    let filterQuery = "";

    /* ---------- util ---------- */
    function currencyFormat(v){ return "$" + v.toFixed(2); }

    /* ---------- promos ---------- */
    function renderPromo(){
      const p = promotions[promoIndex];
      promoImg.src = p.img;
      promoImg.alt = p.title[lang] || p.title['es'];
      promoTitle.textContent = p.title[lang] || p.title['es'];
      promoDesc.textContent = p.desc[lang] || p.desc['es'];
      promoPrice.textContent = p.price[lang] || p.price['es'];
    }
    function startPromoTimer(){
      if(promoTimer) clearInterval(promoTimer);
      promoTimer = setInterval(()=>{ promoIndex = (promoIndex+1) % promotions.length; renderPromo(); }, promoInterval);
    }
    prevPromo.onclick = ()=>{ promoIndex = (promoIndex-1 + promotions.length) % promotions.length; renderPromo(); startPromoTimer(); }
    nextPromo.onclick = ()=>{ promoIndex = (promoIndex+1) % promotions.length; renderPromo(); startPromoTimer(); }

    /* ---------- categories ---------- */
    function renderCategories(){
      categoryList.innerHTML = "";
      categoriesOrder.forEach(cat=>{
        const count = catalog.filter(i=>i.cat===cat).length;
        const btn = document.createElement("div");
        btn.className = "cat-btn";
        btn.tabIndex = 0;
        btn.innerHTML = `<div class="cat-name">${cat}</div><div class="count">${count}</div>`;
        btn.onclick = ()=>{ activeCategory = (activeCategory===cat? null: cat); renderCatalog(); };
        categoryList.appendChild(btn);
      });
    }

    /* ---------- catalog ---------- */
    function renderCatalog(){
      catalogEl.innerHTML = "";
      const q = (filterQuery || "").trim().toLowerCase();
      const items = catalog.filter(item=>{
        if(activeCategory && item.cat !== activeCategory) return false;
        if(q && !( (item.name[lang]||'').toLowerCase().includes(q) || (item.desc[lang]||'').toLowerCase().includes(q) || (item.cat||'').toLowerCase().includes(q) )) return false;
        return true;
      });
      resultsInfo.textContent = items.length + (lang==="es" ? " servicios" : " items") + (activeCategory ? " ‚Ä¢ " + activeCategory : "");
      items.forEach(item=>{
        const card = document.createElement("article");
        card.className = "card";
        const displayPrice = item.offer ? (item.offerPrice||item.price) : item.price;
        const priceText = item.offer ? `<div class="strike">${currencyFormat(item.price)}</div><div class="price">${currencyFormat(displayPrice)}</div>` : `<div class="price">${currencyFormat(displayPrice)}</div>`;
        card.innerHTML = `
          <img src="${item.img}" alt="${(item.name[lang]||item.name['es'])}" loading="lazy"/>
          <h4>${item.name[lang]||item.name['es']}</h4>
          <div class="desc">${item.desc[lang]||item.desc['es']}</div>
          <div class="price-wrap">${priceText}</div>
          <div class="actions">
            <button data-id="${item.id}" class="btn addBtn">Agregar</button>
            <button data-id="${item.id}" class="btn viewBtn">Ver</button>
          </div>
        `;
        catalogEl.appendChild(card);
      });
      attachCardEvents();
    }

    function attachCardEvents(){
      document.querySelectorAll(".addBtn").forEach(btn=>{
        btn.onclick = ()=> addToCart(btn.getAttribute("data-id"),1);
      });
      document.querySelectorAll(".viewBtn").forEach(btn=>{
        btn.onclick = ()=> {
          const id = btn.getAttribute("data-id");
          const it = catalog.find(c=>c.id===id);
          alert(`${it.name[lang]||it.name['es']}\n\n${it.desc[lang]||it.desc['es']}\n\nPrecio: ${currencyFormat(it.offer ? (it.offerPrice||it.price) : it.price)}`);
        };
      });
    }

    /* ---------- cart ---------- */
    function addToCart(id, qty){
      const it = catalog.find(c=>c.id===id);
      if(!it) return;
      cart[id] = cart[id] || { item: it, qty:0 };
      cart[id].qty += qty;
      renderCart();
    }
    function renderCart(){
      cartItemsEl.innerHTML = "";
      let total = 0;
      const values = Object.values(cart);
      cartCountEl.textContent = values.length + " items";
      values.forEach(entry=>{
        const price = entry.item.offer ? (entry.item.offerPrice || entry.item.price) : entry.item.price;
        const lineTotal = price * entry.qty;
        total += lineTotal;
        const div = document.createElement("div");
        div.className = "line";
        div.innerHTML = `<div class="line-left">${entry.item.name[lang]||entry.item.name['es']} x <input type="number" min="1" value="${entry.qty}" data-id="${entry.item.id}" /></div><div class="line-right">${currencyFormat(lineTotal)} <button data-id="${entry.item.id}" class="icon remove">X</button></div>`;
        cartItemsEl.appendChild(div);
      });
      cartTotalEl.textContent = (lang==="es" ? "Total: " : "Total: ") + currencyFormat(total);
      cartItemsEl.querySelectorAll('input[type="number"]').forEach(input=>{
        input.onchange = ()=> {
          const id = input.getAttribute("data-id");
          const v = parseInt(input.value) || 1;
          cart[id].qty = v;
          renderCart();
        };
      });
      cartItemsEl.querySelectorAll('button.remove').forEach(b=>{
        b.onclick = ()=>{
          const id = b.getAttribute("data-id");
          delete cart[id];
          renderCart();
        };
      });
    }
    clearBtn.onclick = ()=> { cart = {}; renderCart(); };

    /* ---------- request (mailto fallback) ---------- */
    requestBtn.onclick = ()=> {
      const room = (roomInput.value || "").trim();
      if(!room){ alert(lang==="es" ? "Ingrese n√∫mero de habitaci√≥n." : "Please enter room number."); return; }
      const items = Object.values(cart);
      if(items.length===0){ alert(lang==="es" ? "El carrito est√° vac√≠o." : "Cart is empty."); return; }

      // Build message
      let bodyLines = [];
      bodyLines.push(lang==="es" ? "Solicitud de servicios extras" : "Extra services request");
      bodyLines.push("");
      bodyLines.push((lang==="es"?"Habitaci√≥n:":"Room:") + " " + room);
      bodyLines.push("");
      bodyLines.push((lang==="es"?"Items:":"Items:"));
      let total = 0;
      items.forEach(entry=>{
        const price = entry.item.offer ? (entry.item.offerPrice || entry.item.price) : entry.item.price;
        const lineTotal = price * entry.qty;
        total += lineTotal;
        bodyLines.push(`- ${entry.item.name[lang]||entry.item.name['es']} x${entry.qty} = ${currencyFormat(lineTotal)}`);
      });
      bodyLines.push("");
      bodyLines.push((lang==="es"?"Total:":"Total:") + " " + currencyFormat(total));
      bodyLines.push("");
      bodyLines.push(lang==="es" ? "Por favor confirmar disponibilidad y forma de pago." : "Please confirm availability and payment method.");

      const subject = encodeURIComponent((lang==="es" ? "Solicitud de servicios - Hab " : "Service request - Rm ") + room);
      let body = encodeURIComponent(bodyLines.join("\n"));

      // If too many items, summarize (mailto length limits)
      if(items.length > 20){
        const summary = lang==="es" ? "Pedido extenso; vea el registro completo en administraci√≥n." : "Order too long; please check admin for full details.";
        body = encodeURIComponent(`${bodyLines.slice(0,20).join("\n")}\n\n... \n${summary}`);
      }

      const mailto = `mailto:${encodeURIComponent(EMAIL_DESTINATION)}?subject=${subject}&body=${body}`;
      window.location.href = mailto;
    };

    /* Optional helper to post order (commented, ready to enable)
       function postOrder(url, payload){
         // fetch(url, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) })
         //   .then(r=>r.json()).then(...).catch(...);
       }
    */

    /* ---------- language, search, UI controls ---------- */
    function applyLang(){
      document.getElementById('cartTitle').textContent = (lang==="es"?"Carrito":"Cart");
      document.getElementById('roomLabel').textContent = (lang==="es"?"N√∫mero de habitaci√≥n":"Room number");
      requestBtn.textContent = (lang==="es"?"Solicitar":"Request");
      clearBtn.textContent = (lang==="es"?"Vaciar":"Clear");
      document.getElementById('currentLang').textContent = (lang==="es"?"Espa√±ol":"English");
      renderCatalog(); renderCart(); renderPromo();
    }
    langSelect.onchange = ()=>{ lang = langSelect.value; applyLang(); };
    searchInput.oninput = ()=>{ filterQuery = searchInput.value; renderCatalog(); };

    /* ---------- sidebar & cart toggle + minimize/compact behavior ---------- */
    toggleSidebarBtn.onclick = ()=>{ sidebar.classList.toggle('open'); };
    toggleCartBtn.onclick = ()=>{ cartEl.classList.toggle('open'); cartEl.style.display = cartEl.style.display === 'none' ? '' : ''; };

    function setSidebarMinimized(min){
      if(min){
        sidebar.classList.add('minimized');
        if(window.innerWidth<=700){ sidebar.style.display='none'; sidebarCompactBar.style.display='flex'; }
      } else {
        sidebar.classList.remove('minimized');
        sidebar.style.display = '';
        sidebarCompactBar.style.display = 'none';
      }
    }
    function setCartMinimized(min){
      if(min){
        cartEl.classList.add('minimized');
        if(window.innerWidth<=700){ cartEl.style.display='none'; cartCompactBar.style.display='flex'; }
      } else {
        cartEl.classList.remove('minimized');
        cartEl.style.display = '';
        cartCompactBar.style.display = 'none';
      }
    }

    minimizeSidebarBtn.onclick = ()=> { setSidebarMinimized(!sidebar.classList.contains('minimized')); };
    minimizeCartBtn.onclick = ()=> { setCartMinimized(!cartEl.classList.contains('minimized')); };

    closeSidebarBtn.onclick = ()=> {
      sidebar.style.display = 'none';
      sidebarCompactBar.style.display = 'flex';
      localStorage.setItem('sidebar_closed', '1');
    };
    closeCartBtn.onclick = ()=> {
      cartEl.style.display = 'none';
      cartCompactBar.style.display = 'flex';
      localStorage.setItem('cart_closed', '1');
    };

    function ensureCompactBars(){
      if(!sidebarCompactBar.querySelector('#expandSidebarCompact')){
        sidebarCompactBar.innerHTML = `<button id="expandSidebarCompact" class="btn">‚â°</button>`;
        document.getElementById('expandSidebarCompact').onclick = ()=>{
          sidebar.style.display = '';
          sidebarCompactBar.style.display = 'none';
          localStorage.removeItem('sidebar_closed');
        };
      }
      if(!cartCompactBar.querySelector('#expandCartCompact')){
        cartCompactBar.innerHTML = `<button id="expandCartCompact" class="btn">üõí</button>`;
        document.getElementById('expandCartCompact').onclick = ()=>{
          cartEl.style.display = '';
          cartCompactBar.style.display = 'none';
          localStorage.removeItem('cart_closed');
        };
      }
    }

    /* ---------- background controls (localStorage) ---------- */
    function applyBackground(css){
      document.documentElement.style.setProperty('--bg-css', css);
      localStorage.setItem('catalog_bg', css);
    }
    applyBgBtn.onclick = ()=>{
      const url = bgUrlInput.value.trim();
      if(!url){ alert(lang==='es' ? 'Ingrese URL v√°lida' : 'Enter valid URL'); return; }
      const css = `url("${url}") center/cover fixed no-repeat, linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.6))`;
      applyBackground(css);
    };
    applyGradientBtn.onclick = ()=>{
      const grad = bgGradientSel.value;
      applyBackground(grad);
    };
    const savedBg = localStorage.getItem('catalog_bg');
    if(savedBg) applyBackground(savedBg);

    /* ---------- misc UI ---------- */
    showAllBtn.onclick = ()=>{ activeCategory=null; renderCatalog(); };

    document.addEventListener('click', (e)=>{
      if(window.innerWidth<=1000 && !sidebar.contains(e.target) && !toggleSidebarBtn.contains(e.target)){
        sidebar.classList.remove('open');
      }
    });

    /* ---------- initialize ---------- */
    function init(){
      renderCategories();
      renderCatalog();
      renderCart();
      renderPromo();
      startPromoTimer();
      ensureCompactBars();
      if(localStorage.getItem('sidebar_closed')==='1'){ sidebar.style.display='none'; sidebarCompactBar.style.display='flex'; }
      if(localStorage.getItem('cart_closed')==='1'){ cartEl.style.display='none'; cartCompactBar.style.display='flex'; }
      const navLang = navigator.language ? navigator.language.slice(0,2) : null;
      if(navLang && (navLang==="es"||navLang==="en")){ lang = navLang; langSelect.value = lang; applyLang(); }
    }
    init();

    /* Accessibility & resize */
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ sidebar.classList.remove('open'); } });
    window.addEventListener('resize', ()=> {
      if(window.innerWidth > 1000){
        if(!localStorage.getItem('sidebar_closed')) sidebarCompactBar.style.display = 'none';
        if(!localStorage.getItem('cart_closed')) cartCompactBar.style.display = 'none';
        if(sidebar.classList.contains('minimized')) sidebar.style.display = '';
        if(cartEl.classList.contains('minimized')) cartEl.style.display = '';
      }
    });

    /* ========== HOW TO EDIT PRODUCTS (short) ==========
       1) Open index.html and find the `catalog` array near the top of the script.
       2) Add a new object with structure:
          {
            id: "unique_id",
            cat: "Tratamientos del SPA", // one of categoriesOrder
            img: "images/mi.jpg" OR "https://...",
            name: { es: "Nombre ES", en: "Name EN" },
            desc: { es: "Desc ES", en: "Desc EN" },
            price: 45.00,
            currency: "USD",
            offer: false,
            offerText: { es: "10% hoy", en: "10% today" }, // optional
            offerPrice: 40.50 // optional
          }
       3) Save and deploy (push to GitHub) ‚Äî site reloads automatically on GitHub Pages.
       ------------ QA CHECKLIST (short) ------------
       - Promo rotates; prev/next buttons work.
       - Add items, change qty; totals correct.
       - Enter room number and click Solicitar -> mail client opens with EMAIL_DESTINATION filled.
       - Menu and cart minimize/close/reopen correctly on mobile and desktop.
       - Background choice persists after reload.
    ================================================== */
  </script>
</body>
</html>




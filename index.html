<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Catálogo Servicios Extras - Hotel</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --accent:#0b66a3;
      --accent-2:#0b6623;
      --soft:#f5f7fa;
      --card:#ffffff;
      --muted:#667085;
      --glass: rgba(255,255,255,0.75);
      --radius:12px;
      --max-width:1100px;
      --bg-css: linear-gradient(180deg,#eef6fb 0%,#f7fafc 100%);
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:#0f1724;background:var(--bg-css);transition:background .35s ease;}
    .wrap{max-width:var(--max-width);margin:16px auto;padding:16px;position:relative;z-index:2}
    header{display:flex;align-items:center;gap:12px;justify-content:space-between;margin-bottom:12px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:10px;overflow:hidden;box-shadow:0 6px 18px rgba(11,102,163,0.12);background:linear-gradient(135deg,var(--accent),#5bb1e8)}
    .logo span{display:block;color:#fff;font-weight:800;font-size:22px;text-align:center;line-height:56px}
    h1{font-size:18px;margin:0;color:#073b57}
    .controls{display:flex;gap:8px;align-items:center}
    select,button,input{padding:8px 10px;border-radius:8px;border:1px solid #d1d9e6;background:#fff;cursor:pointer}
    button.primary{background:var(--accent);color:#fff;border-color:rgba(0,0,0,0.06)}
    .layout{display:grid;grid-template-columns:280px 1fr 360px;gap:14px;align-items:start}
    @media (max-width:1000px){ .layout{grid-template-columns:1fr;} #sidebar{position:fixed;left:-320px;top:0;height:100%;z-index:60;transition:left .28s ease} #sidebar.open{left:0} #cart{position:fixed;right:12px;bottom:12px;width:320px} }

    /* Sidebar */
    #sidebar{background:var(--glass);backdrop-filter: blur(6px);padding:14px;border-radius:var(--radius);box-shadow:0 8px 30px rgba(16,24,40,0.06);height:fit-content;min-height:120px;position:relative}
    .side-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;gap:8px}
    .menu-title{font-weight:700;margin-bottom:4px;color:#073b57}
    .category{display:flex;flex-direction:column;gap:8px}
    .cat-btn{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:#fff;border:1px solid #e6eef6;cursor:pointer}
    .cat-btn:hover{box-shadow:0 6px 18px rgba(11,102,163,0.06)}
    .sidebar-min{width:36px;height:36px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;background:#fff;border:1px solid #e6eef6;cursor:pointer}

    /* Main content */
    main{min-height:60vh}
    .promo{background:linear-gradient(90deg,#eaf6ff,#f3fff4);padding:12px;border-radius:12px;display:flex;align-items:center;gap:12px;box-shadow:0 6px 18px rgba(11,102,163,0.04)}
    .promo img{width:84px;height:64px;object-fit:cover;border-radius:8px}
    .promo .txt{flex:1}
    .promo h3{margin:0;font-size:16px;color:#04476a}
    .promo p{margin:4px 0;color:#065a8a}
    .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px;margin-top:14px}
    .card{background:var(--card);padding:12px;border-radius:12px;border:1px solid #e6eef6;box-shadow:0 8px 22px rgba(13,20,30,0.03);display:flex;flex-direction:column}
    .card img{width:100%;height:150px;object-fit:cover;border-radius:8px}
    .card h4{margin:10px 0 6px;font-size:16px;color:#073b57}
    .desc{color:var(--muted);font-size:13px;flex:1}
    .price{font-weight:700;color:var(--accent-2);margin-top:8px}
    .actions{display:flex;gap:8px;margin-top:10px}

    /* Cart */
    #cart{background:linear-gradient(180deg,#fff,#fbfeff);padding:14px;border-radius:12px;border:1px solid #e6eef6;box-shadow:0 10px 30px rgba(11,33,62,0.06);position:relative}
    .cart-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;gap:8px}
    #cart h3{margin:0 0 8px;font-size:16px;color:#073b57}
    .line{display:flex;justify-content:space-between;align-items:center;margin:8px 0}
    .total{font-weight:800;margin-top:12px;color:#063a56}
    .cart-min{width:36px;height:36px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;background:#fff;border:1px solid #e6eef6;cursor:pointer}

    /* Compact bars */
    .compact-bar{
      position:fixed;
      z-index:80;
      display:flex;
      align-items:center;
      gap:6px;
      padding:6px;
      border-radius:10px;
      background:rgba(255,255,255,0.96);
      box-shadow:0 8px 20px rgba(8,20,40,0.08);
      display:none;
    }
    #sidebarCompactBar{left:10px;top:70px}
    #cartCompactBar{right:10px;bottom:14px}
    .compact-bar button{border:1px solid #e6eef6;padding:8px 10px;border-radius:8px;background:#fff;cursor:pointer}

    /* Minimized styles */
    #sidebar.minimized{width:56px !important;padding:8px !important;overflow:hidden}
    #sidebar.minimized .category,#sidebar.minimized .bg-control,#sidebar.minimized .menu-title,#sidebar.minimized .muted,#sidebar.minimized .cat-btn{display:none}
    #sidebar.minimized .side-header{justify-content:center}
    #cart.minimized{width:64px !important;padding:8px !important;overflow:hidden;height:auto}
    #cart.minimized > :not(.cart-header){display:none}
    #cart.minimized .cart-header{justify-content:center}

    .muted{color:var(--muted);font-size:13px}
    .bg-control{display:flex;gap:8px;align-items:center;margin-top:10px}
    .bg-control input{width:220px}
    .bg-decor{position:fixed;right:-120px;bottom:-120px;width:420px;height:420px;background:radial-gradient(circle at 30% 30%, rgba(11,102,163,0.08), transparent 30%), radial-gradient(circle at 70% 70%, rgba(11,102,35,0.06), transparent 30%);filter:blur(12px);z-index:0}
    footer{margin-top:18px;font-size:13px;color:var(--muted);text-align:center}

    @media (max-width:700px){
      .hidden-mobile{display:none}
      .logo{width:48px;height:48px}
      input[type="search"]{display:none}
      #sidebar.minimized{left:8px;top:60px;position:fixed;z-index:70;height:44px;border-radius:10px}
      #cart.minimized{right:8px;bottom:70px;position:fixed;z-index:70;height:44px;border-radius:10px}
      .layout{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="bg-decor" aria-hidden="true"></div>

  <div class="wrap" role="application">
    <header>
      <div class="brand">
        <div class="logo"><span>H</span></div>
        <div>
          <h1>Servicios Extras - Hotel 5★</h1>
          <div class="muted">Escanea el QR o usa este catálogo</div>
        </div>
      </div>

      <div class="controls" role="toolbar" aria-label="Controles">
        <input id="searchInput" type="search" placeholder="Buscar servicio o producto..." class="hidden-mobile" />
        <select id="lang" aria-label="Idioma">
          <option value="es">Español</option>
          <option value="en">English</option>
        </select>
        <button id="toggleSidebarBtn" class="primary" title="Abrir/Cerrar menú">Menú</button>
        <button id="toggleCartBtn" title="Abrir/Cerrar carrito">Carrito</button>
      </div>
    </header>

    <div class="layout" id="layout">
      <!-- Sidebar -->
      <aside id="sidebar" aria-label="Menú de categorías">
        <div class="side-header">
          <div>
            <div class="menu-title">Categorías</div>
            <div class="muted">Filtra por sección</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <button id="minimizeSidebar" class="sidebar-min" title="Minimizar menú">_</button>
            <button id="closeSidebar" class="sidebar-min" title="Cerrar menú">X</button>
          </div>
        </div>

        <div class="category" id="categoryList"></div>

        <div style="margin-top:12px">
          <button id="showAll" style="width:100%;padding:10px;border-radius:10px;border:1px solid #e6eef6;background:#fff">Mostrar todo</button>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid #eef6fb"/>

        <div class="menu-title" style="font-size:14px">Fondo (personalizable)</div>
        <div class="bg-control">
          <input id="bgUrl" placeholder="URL imagen de fondo (https...)" />
          <button id="applyBg">Aplicar</button>
        </div>
        <div class="bg-control" style="margin-top:8px">
          <select id="bgGradient">
            <option value="linear-gradient(180deg,#eef6fb 0%,#f7fafc 100%)">Azul claro</option>
            <option value="linear-gradient(180deg,#fff7ed 0%,#fff1f0 100%)">Crema</option>
            <option value="linear-gradient(180deg,#f3fff4 0%,#eef9ff 100%)">Verde suave</option>
            <option value="linear-gradient(180deg,#1e3a8a 0%,#0ea5e9 100%)">Azul intenso</option>
          </select>
          <button id="applyGradient">Usar gradiente</button>
        </div>

      </aside>

      <!-- Main -->
      <main>
        <div id="promoContainer" class="promo" role="region" aria-live="polite">
          <img id="promoImg" src="" alt="" />
          <div class="txt">
            <h3 id="promoTitle">Promoción</h3>
            <p id="promoDesc">Descripción de promoción</p>
          </div>
          <div style="min-width:120px;text-align:right">
            <div class="offers-banner" id="promoPrice">-</div>
            <div style="margin-top:6px">
              <button id="prevPromo">◀</button>
              <button id="nextPromo" class="primary">▶</button>
            </div>
          </div>
        </div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:14px">
          <div class="muted" id="resultsInfo">Mostrando todos los servicios</div>
          <div class="muted">Idioma: <strong id="currentLang">Español</strong></div>
        </div>

        <section class="cards" id="catalog" aria-live="polite"></section>
      </main>

      <!-- Cart -->
      <aside id="cart" aria-label="Carrito de compras">
        <div class="cart-header">
          <div>
            <h3 id="cartTitle">Carrito</h3>
            <div class="muted" id="cartCount">0 items</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <button id="minimizeCart" class="cart-min" title="Minimizar carrito">_</button>
            <button id="closeCart" class="cart-min" title="Cerrar carrito">X</button>
          </div>
        </div>

        <div id="cartItems"></div>
        <div class="total" id="cartTotal">Total: $0.00</div>

        <div style="margin-top:12px">
          <label for="roomInput" id="roomLabel">Número de habitación</label>
          <input id="roomInput" type="text" placeholder="e.g. 101" />
        </div>

        <div style="margin-top:10px;display:flex;gap:8px;justify-content:space-between">
          <button id="clearBtn">Vaciar</button>
          <button class="primary" id="requestBtn">Solicitar</button>
        </div>

        <div style="margin-top:12px;font-size:13px;color:var(--muted)">
          Las solicitudes se envían por correo al equipo de servicios del hotel.
        </div>
      </aside>
    </div>

    <footer>Diseñado para uso interno del hotel • Edita productos en el arreglo <code>catalog</code> dentro del script</footer>
  </div>

  <!-- Compact bars (para reabrir menú / carrito después de cerrar) -->
  <div id="sidebarCompactBar" class="compact-bar" aria-hidden="true"></div>
  <div id="cartCompactBar" class="compact-bar" aria-hidden="true"></div>

  <script>
    /* ============================== */
    /*  CONFIGURACIÓN FÁCIL (al inicio) */
    /*  Cambia aquí la dirección de correo si lo necesitas */
    const EMAIL_DESTINATION = "tu-correo@hotel.com";
    /* ============================== */

    /* ---------- Datos: promociones y catálogo ---------- */
    const promotions = [
      { id:"p1", img:"https://images.unsplash.com/photo-1505751172876-fa1923c5c528?w=1200&q=60", title:{es:"20% en Cena Privada",en:"20% off Private Dinner"}, desc:{es:"Experiencia gourmet en ambiente privado. Oferta por tiempo limitado.",en:"Gourmet private dinner experience. Limited time offer."}, price:{es:"Desde $96",en:"From $96"} },
      { id:"p2", img:"https://images.unsplash.com/photo-1556228720-5f7c8a1da0f9?w=1200&q=60", title:{es:"Masaje relajante 60min - pack",en:"Relaxing Massage 60min - pack"}, desc:{es:"Relájate con nuestro masaje profesional. Reserva con descuento.",en:"Relax with our professional massage. Book now with discount."}, price:{es:"$70",en:"$70"} }
    ];
    let promoIndex = 0, promoTimer = null, promoInterval = 6000;

    const catalog = [
      // Tratamientos del SPA
      { id:"spa001", cat:"Tratamientos del SPA", img:"https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?w=800&q=60", name:{es:"Masaje Relajante 60min",en:"Relaxing Massage 60min"}, desc:{es:"Masaje profesional para aliviar tensiones.",en:"Professional massage to relieve tension."}, price:70.00, currency:"USD", offer:false },
      { id:"spa002", cat:"Tratamientos del SPA", img:"https://images.unsplash.com/photo-1556228720-5f7c8a1da0f9?w=800&q=60", name:{es:"Masaje Profundo 90min",en:"Deep Massage 90min"}, desc:{es:"Terapéutico profundo para contracturas.",en:"Therapeutic deep massage for knots."}, price:95.00, currency:"USD", offer:true, offerText:{es:"10% hoy",en:"10% today"}, offerPrice:85.50 },

      // Salón de Belleza
      { id:"belleza001", cat:"Salón de Belleza", img:"https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=800&q=60", name:{es:"Peinado Profesional",en:"Professional Hairstyling"}, desc:{es:"Peinado y styling para ocasiones especiales.",en:"Hair styling for special occasions."}, price:45.00, currency:"USD", offer:false },

      // Servicio de Boda
      { id:"boda001", cat:"Servicio de Boda", img:"https://images.unsplash.com/photo-1519677100203-a0e668c92439?w=800&q=60", name:{es:"Paquete Boda Básico",en:"Basic Wedding Package"}, desc:{es:"Coordinación y espacios para ceremonia íntima.",en:"Coordination and intimate ceremony spaces."}, price:1200.00, currency:"USD", offer:false },

      // Ventas en Recepción
      { id:"recepcion001", cat:"Ventas en Recepción", img:"https://images.unsplash.com/photo-1556740749-887f6717d7e4?w=800&q=60", name:{es:"Mapa Turístico Local",en:"Local Tourist Map"}, desc:{es:"Mapa impreso con recomendaciones locales.",en:"Printed map with local recommendations."}, price:5.00, currency:"USD", offer:false },

      // Extra Carta Comida
      { id:"carta001", cat:"Extra Carta Comida", img:"https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=800&q=60", name:{es:"Tapa Gourmet",en:"Gourmet Starter"}, desc:{es:"Entrada seleccionada por el chef.",en:"Chef-selected starter."}, price:12.00, currency:"USD", offer:false },

      // Cenas privadas
      { id:"dinner001", cat:"Cenas privadas", img:"https://images.unsplash.com/photo-1541542684-6b2a3c2b3f9d?w=800&q=60", name:{es:"Cena Privada para 2",en:"Private Dinner for 2"}, desc:{es:"Menú gourmet y ambiente privado.",en:"Gourmet menu and private ambiance."}, price:120.00, currency:"USD", offer:true, offerText:{es:"20% de descuento hoy",en:"20% off today"}, offerPrice:96.00 },

      // Vinos y Cavas
      { id:"vino001", cat:"Vinos y Cavas", img:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=800&q=60", name:{es:"Botella Premium",en:"Premium Bottle"}, desc:{es:"Selección de la cava para su disfrute.",en:"Cellar selection for your enjoyment."}, price:45.00, currency:"USD", offer:false },

      // Servicio de Lavandería
      { id:"lav001", cat:"Servicio de Lavandería", img:"https://images.unsplash.com/photo-1542831371-d531d36971e6?w=800&q=60", name:{es:"Lavado Express",en:"Express Wash"}, desc:{es:"Servicio rápido con entrega en el día.",en:"Quick service with same-day delivery."}, price:8.00, currency:"USD", offer:false }
    ];

    const categoriesOrder = ["Tratamientos del SPA","Salón de Belleza","Servicio de Boda","Ventas en Recepción","Extra Carta Comida","Cenas privadas","Vinos y Cavas","Servicio de Lavandería"];

    /* ---------- UI refs ---------- */
    const catalogEl = document.getElementById("catalog");
    const langSelect = document.getElementById("lang");
    const cartItemsEl = document.getElementById("cartItems");
    const cartTotalEl = document.getElementById("cartTotal");
    const requestBtn = document.getElementById("requestBtn");
    const clearBtn = document.getElementById("clearBtn");
    const roomInput = document.getElementById("roomInput");
    const promoImg = document.getElementById("promoImg");
    const promoTitle = document.getElementById("promoTitle");
    const promoDesc = document.getElementById("promoDesc");
    const promoPrice = document.getElementById("promoPrice");
    const prevPromo = document.getElementById("prevPromo");
    const nextPromo = document.getElementById("nextPromo");
    const resultsInfo = document.getElementById("resultsInfo");
    const currentLangLabel = document.getElementById("currentLang");
    const categoryList = document.getElementById("categoryList");
    const sidebar = document.getElementById("sidebar");
    const toggleSidebarBtn = document.getElementById("toggleSidebarBtn");
    const toggleCartBtn = document.getElementById("toggleCartBtn");
    const minimizeSidebarBtn = document.getElementById("minimizeSidebar");
    const closeSidebarBtn = document.getElementById("closeSidebar");
    const minimizeCartBtn = document.getElementById("minimizeCart");
    const closeCartBtn = document.getElementById("closeCart");
    const cartEl = document.getElementById("cart");
    const searchInput = document.getElementById("searchInput");
    const cartCountEl = document.getElementById("cartCount");
    const bgUrlInput = document.getElementById("bgUrl");
    const applyBgBtn = document.getElementById("applyBg");
    const bgGradientSel = document.getElementById("bgGradient");
    const applyGradientBtn = document.getElementById("applyGradient");
    const showAllBtn = document.getElementById("showAll");
    const sidebarCompactBar = document.getElementById('sidebarCompactBar');
    const cartCompactBar = document.getElementById('cartCompactBar');

    /* ---------- state ---------- */
    let lang = 'es';
    let cart = {};
    let activeCategory = null;
    let filterQuery = "";

    /* ---------- util ---------- */
    function currencyFormat(v){ return "$" + v.toFixed(2); }

    /* ---------- promos ---------- */
    function renderPromo(){
      const p = promotions[promoIndex];
      promoImg.src = p.img;
      promoImg.alt = p.title[lang] || p.title['es'];
      promoTitle.textContent = p.title[lang] || p.title['es'];
      promoDesc.textContent = p.desc[lang] || p.desc['es'];
      promoPrice.textContent = p.price[lang] || p.price['es'];
    }
    function startPromoTimer(){
      if(promoTimer) clearInterval(promoTimer);
      promoTimer = setInterval(()=>{ promoIndex = (promoIndex+1) % promotions.length; renderPromo(); }, promoInterval);
    }
    prevPromo.onclick = ()=>{ promoIndex = (promoIndex-1 + promotions.length) % promotions.length; renderPromo(); startPromoTimer(); }
    nextPromo.onclick = ()=>{ promoIndex = (promoIndex+1) % promotions.length; renderPromo(); startPromoTimer(); }

    /* ---------- categories ---------- */
    function renderCategories(){
      categoryList.innerHTML = "";
      categoriesOrder.forEach(cat=>{
        const count = catalog.filter(i=>i.cat===cat).length;
        const btn = document.createElement("div");
        btn.className = "cat-btn";
        btn.tabIndex = 0;
        btn.innerHTML = `<div>${cat}</div><div class="count">${count}</div>`;
        btn.onclick = ()=>{ activeCategory = (activeCategory===cat? null: cat); renderCatalog(); };
        categoryList.appendChild(btn);
      });
    }

    /* ---------- catalog ---------- */
    function renderCatalog(){
      catalogEl.innerHTML = "";
      const q = (filterQuery || "").trim().toLowerCase();
      const items = catalog.filter(item=>{
        if(activeCategory && item.cat !== activeCategory) return false;
        if(q && !( (item.name[lang]||'').toLowerCase().includes(q) || (item.desc[lang]||'').toLowerCase().includes(q) || (item.cat||'').toLowerCase().includes(q) )) return false;
        return true;
      });
      resultsInfo.textContent = items.length + (lang==="es" ? " servicios" : " items") + (activeCategory ? " • " + activeCategory : "");
      items.forEach(item=>{
        const card = document.createElement("article");
        card.className = "card";
        const displayPrice = item.offer ? (item.offerPrice||item.price) : item.price;
        const priceText = item.offer ? `<div style="font-size:13px;color:#b21b1b;text-decoration:line-through">${currencyFormat(item.price)}</div><div class="price">${currencyFormat(displayPrice)}</div>` : `<div class="price">${currencyFormat(displayPrice)}</div>`;
        card.innerHTML = `
          <img src="${item.img}" alt="${(item.name[lang]||item.name['es'])}" loading="lazy"/>
          <h4>${item.name[lang]||item.name['es']}</h4>
          <div class="desc">${item.desc[lang]||item.desc['es']}</div>
          <div style="margin-top:8px">${priceText}</div>
          <div class="actions">
            <button data-id="${item.id}" class="addBtn">Agregar</button>
            <button data-id="${item.id}" class="viewBtn">Ver</button>
          </div>
        `;
        catalogEl.appendChild(card);
      });
      attachCardEvents();
    }

    function attachCardEvents(){
      document.querySelectorAll(".addBtn").forEach(btn=>{
        btn.onclick = ()=> addToCart(btn.getAttribute("data-id"),1);
      });
      document.querySelectorAll(".viewBtn").forEach(btn=>{
        btn.onclick = ()=> {
          const id = btn.getAttribute("data-id");
          const it = catalog.find(c=>c.id===id);
          alert(`${it.name[lang]||it.name['es']}\n\n${it.desc[lang]||it.desc['es']}\n\nPrecio: ${currencyFormat(it.offer ? (it.offerPrice||it.price) : it.price)}`);
        };
      });
    }

    /* ---------- cart ---------- */
    function addToCart(id, qty){
      const it = catalog.find(c=>c.id===id);
      if(!it) return;
      cart[id] = cart[id] || { item: it, qty:0 };
      cart[id].qty += qty;
      renderCart();
    }
    function renderCart(){
      cartItemsEl.innerHTML = "";
      let total = 0;
      const values = Object.values(cart);
      cartCountEl.textContent = values.length + " items";
      values.forEach(entry=>{
        const price = entry.item.offer ? (entry.item.offerPrice || entry.item.price) : entry.item.price;
        const lineTotal = price * entry.qty;
        total += lineTotal;
        const div = document.createElement("div");
        div.className = "line";
        div.innerHTML = `<div style="width:60%">${entry.item.name[lang]||entry.item.name['es']} x <input type="number" min="1" value="${entry.qty}" data-id="${entry.item.id}" style="width:56px"/></div><div style="text-align:right">${currencyFormat(lineTotal)} <button data-id="${entry.item.id}" style="margin-left:8px">X</button></div>`;
        cartItemsEl.appendChild(div);
      });
      cartTotalEl.textContent = (lang==="es" ? "Total: " : "Total: ") + currencyFormat(total);
      cartItemsEl.querySelectorAll('input[type="number"]').forEach(input=>{
        input.onchange = ()=> {
          const id = input.getAttribute("data-id");
          const v = parseInt(input.value) || 1;
          cart[id].qty = v;
          renderCart();
        };
      });
      cartItemsEl.querySelectorAll('button[data-id]').forEach(b=>{
        b.onclick = ()=>{
          const id = b.getAttribute("data-id");
          delete cart[id];
          renderCart();
        };
      });
    }
    clearBtn.onclick = ()=> { cart = {}; renderCart(); };

    /* ---------- request (mailto fallback) ---------- */
    requestBtn.onclick = ()=> {
      const room = (roomInput.value || "").trim();
      if(!room){ alert(lang==="es" ? "Ingrese número de habitación." : "Please enter room number."); return; }
      const items = Object.values(cart);
      if(items.length===0){ alert(lang==="es" ? "El carrito está vacío." : "Cart is empty."); return; }
      let bodyLines = [];
      bodyLines.push(lang==="es" ? "Solicitud de servicios extras" : "Extra services request");
      bodyLines.push("");
      bodyLines.push((lang==="es"?"Habitación:":"Room:") + " " + room);
      bodyLines.push("");
      bodyLines.push((lang==="es"?"Items:":"Items:"));
      let total = 0;
      items.forEach(entry=>{
        const price = entry.item.offer ? (entry.item.offerPrice || entry.item.price) : entry.item.price;
        const lineTotal = price * entry.qty;
        total += lineTotal;
        bodyLines.push(`- ${entry.item.name[lang]||entry.item.name['es']} x${entry.qty} = ${currencyFormat(lineTotal)}`);
      });
      bodyLines.push("");
      bodyLines.push((lang==="es"?"Total:":"Total:") + " " + currencyFormat(total));
      bodyLines.push("");
      bodyLines.push(lang==="es" ? "Por favor confirmar disponibilidad y forma de pago." : "Please confirm availability and payment method.");
      const subject = encodeURIComponent((lang==="es" ? "Solicitud de servicios - Hab " : "Service request - Rm ") + room);
      const body = encodeURIComponent(bodyLines.join("\n"));
      const mailto = `mailto:${encodeURIComponent(EMAIL_DESTINATION)}?subject=${subject}&body=${body}`;
      window.location.href = mailto;
    };

    /* ---------- language, search, UI controls ---------- */
    function applyLang(){
      document.getElementById('cartTitle').textContent = (lang==="es"?"Carrito":"Cart");
      document.getElementById('roomLabel').textContent = (lang==="es"?"Número de habitación":"Room number");
      requestBtn.textContent = (lang==="es"?"Solicitar":"Request");
      clearBtn.textContent = (lang==="es"?"Vaciar":"Clear");
      document.getElementById('currentLang').textContent = (lang==="es"?"Español":"English");
      renderCatalog(); renderCart(); renderPromo();
    }
    langSelect.onchange = ()=>{ lang = langSelect.value; applyLang(); };
    searchInput.oninput = ()=>{ filterQuery = searchInput.value; renderCatalog(); };

    /* ---------- sidebar & cart toggle + minimize/expand/compact ---------- */
    toggleSidebarBtn.onclick = ()=>{ sidebar.classList.toggle('open'); };
    toggleCartBtn.onclick = ()=>{ cartEl.classList.toggle('open'); cartEl.style.display = cartEl.style.display === 'none' ? '' : ''; };

    function setSidebarMinimized(min){
      if(min){
        sidebar.classList.add('minimized');
        if(window.innerWidth<=700){ sidebar.style.display='none'; sidebarCompactBar.style.display='flex'; }
      } else {
        sidebar.classList.remove('minimized');
        sidebar.style.display = '';
        sidebarCompactBar.style.display = 'none';
      }
    }
    function setCartMinimized(min){
      if(min){
        cartEl.classList.add('minimized');
        if(window.innerWidth<=700){ cartEl.style.display='none'; cartCompactBar.style.display='flex'; }
      } else {
        cartEl.classList.remove('minimized');
        cartEl.style.display = '';
        cartCompactBar.style.display = 'none';
      }
    }

    minimizeSidebarBtn.onclick = ()=> { setSidebarMinimized(!sidebar.classList.contains('minimized')); };
    minimizeCartBtn.onclick = ()=> { setCartMinimized(!cartEl.classList.contains('minimized')); };

    closeSidebarBtn.onclick = ()=> {
      sidebar.style.display = 'none';
      sidebarCompactBar.style.display = 'flex';
      localStorage.setItem('sidebar_closed', '1');
    };
    closeCartBtn.onclick = ()=> {
      cartEl.style.display = 'none';
      cartCompactBar.style.display = 'flex';
      localStorage.setItem('cart_closed', '1');
    };

    // Create compact expand buttons if not present
    function ensureCompactBars(){
      if(!sidebarCompactBar.querySelector('#expandSidebarCompact')){
        sidebarCompactBar.innerHTML = `<button id="expandSidebarCompact" title="Abrir menú">≡</button>`;
        document.getElementById('expandSidebarCompact').onclick = ()=>{
          sidebar.style.display = '';
          sidebarCompactBar.style.display = 'none';
          localStorage.removeItem('sidebar_closed');
        };
      }
      if(!cartCompactBar.querySelector('#expandCartCompact')){
        cartCompactBar.innerHTML = `<button id="expandCartCompact" title="Abrir carrito">🛒</button>`;
        document.getElementById('expandCartCompact').onclick = ()=>{
          cartEl.style.display = '';
          cartCompactBar.style.display = 'none';
          localStorage.removeItem('cart_closed');
        };
      }
    }

    /* ---------- background controls (localStorage) ---------- */
    function applyBackground(css){
      document.documentElement.style.setProperty('--bg-css', css);
      localStorage.setItem('catalog_bg', css);
    }
    applyBgBtn.onclick = ()=>{
      const url = bgUrlInput.value.trim();
      if(!url){ alert(lang==='es' ? 'Ingrese URL válida' : 'Enter valid URL'); return; }
      const css = `url("${url}") center/cover fixed no-repeat, linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.6))`;
      applyBackground(css);
    };
    applyGradientBtn.onclick = ()=>{
      const grad = bgGradientSel.value;
      applyBackground(grad);
    };
    const savedBg = localStorage.getItem('catalog_bg');
    if(savedBg) applyBackground(savedBg);

    /* ---------- misc UI ---------- */
    showAllBtn.onclick = ()=>{ activeCategory=null; renderCatalog(); };

    document.addEventListener('click', (e)=>{
      if(window.innerWidth<=1000 && !sidebar.contains(e.target) && !toggleSidebarBtn.contains(e.target)){
        sidebar.classList.remove('open');
      }
    });

    /* ---------- initialize ---------- */
    function init(){
      renderCategories();
      renderCatalog();
      renderCart();
      renderPromo();
      startPromoTimer();
      ensureCompactBars();
      // respect saved closed state
      if(localStorage.getItem('sidebar_closed')==='1'){ sidebar.style.display='none'; sidebarCompactBar.style.display='flex'; }
      if(localStorage.getItem('cart_closed')==='1'){ cartEl.style.display='none'; cartCompactBar.style.display='flex'; }
      // language from browser
      const navLang = navigator.language ? navigator.language.slice(0,2) : null;
      if(navLang && (navLang==="es"||navLang==="en")){ lang = navLang; langSelect.value = lang; applyLang(); }
    }
    init();

    /* ---------- accessibility and resize behavior ---------- */
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ sidebar.classList.remove('open'); } });
    window.addEventListener('resize', ()=> {
      if(window.innerWidth > 1000){
        if(!localStorage.getItem('sidebar_closed')) sidebarCompactBar.style.display = 'none';
        if(!localStorage.getItem('cart_closed')) cartCompactBar.style.display = 'none';
        if(sidebar.classList.contains('minimized')) sidebar.style.display = '';
        if(cartEl.classList.contains('minimized')) cartEl.style.display = '';
      }
    });

    /* ========== NOTA: editar productos ========== 
       - Para añadir/quitar/editar productos modifica el arreglo `catalog` al inicio del script.
       - Estructura de un producto (campos obligatorios):
         {
           id: "unique_id",
           cat: "Categoría exactamente como aparece en categoriesOrder",
           img: "https://tu-dominio/imagen.jpg",
           name: { es: "Nombre en español", en: "Name in English" },
           desc: { es: "Descripción en español", en: "Description in English" },
           price: 45.00,
           currency: "USD",
           offer: false,                // true si hay descuento
           offerText: { es: "10% hoy", en: "10% today" }, // opcional
           offerPrice: 40.50           // opcional si offer true
         }
       - Guarda imágenes en tu repo en /images y usa rutas relativas "images/mi.jpg" o usa URLs CDN.
       - Para idiomas adicionales añade claves (por ejemplo fr) en name y desc y agrega la opción en el <select id="lang">.
    */

  </script>
</body>
</html>
